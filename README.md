# Yelp Coffee & Tea Analysis (with SQL + NLP)

This project explores the [Yelp Open Dataset](https://www.yelp.com/dataset) with a focus on **Coffee & Tea** businesses.  
The goal: uncover what truly drives customer satisfaction and visibility.  

I combine **SQL + Python** for structured data analysis and **NLP (TF-IDF)** for unstructured review text.  
The result: a reproducible pipeline and interpretable insights about how reputation is shaped.

---

## Dataset & Pipeline

- **Source:** [Yelp Academic Dataset](https://www.yelp.com/dataset)
- **Scope:** Coffee & Tea businesses and their reviews  
- **Stack:** PostgreSQL • SQLAlchemy • pandas • scikit-learn (TF-IDF)  
- **ETL:** JSON → Postgres raw tables → reduced/cleaned tables → analysis & NLP  
- **Sample Data:** This repo ships with small CSV samples so anyone can run the pipeline without the full 9GB dataset.

**Full dataset sizes**
- Businesses: 150,346 total → 6,704 Coffee & Tea  
- Reviews: 6,990,280 total → 442,356 for Coffee & Tea  

**Sample in repo**
- `sample_business.csv` (≈100 rows)  
- `sample_review.csv` (≈300 rows)  
- Stored in `data/raw_data/` and generated by the SQL notebook.  

---

## Key Findings

### 1. Popularity vs. Rating
- Shops with more reviews enjoy *slightly higher ratings*.  
- **Correlation (r):** ≈ +0.18 between review count and rating.  
- Example:  
  - <50 reviews → avg rating = 3.9★  
  - >500 reviews → avg rating = 4.2★  

**Figure 1. Ratings vs. Reviews**  
![Ratings vs Reviews](report/ratings_vs_reviews.png)

---

### 2. Urban vs. Non-Urban Shops
- **Urban shops**: avg rating = 4.15★, ~3× more reviews.  
- **Non-urban shops**: avg rating = 3.95★.  
- Visibility is a key driver: volume and foot traffic matter.  

---

### 3. Amenities & Price
- Amenities such as Wi-Fi, outdoor seating, or even price band had **weak correlations (r ≈ 0.05)** with ratings.  
- In other words, these checklist features don’t explain much variance in satisfaction.  

**Figure 2. Amenities/Price vs. Ratings**  
![Amenities vs Ratings](report/amenities_vs_ratings.png)

---

## NLP Insights from Reviews

### Methods
- **Preprocessing:** lowercasing, punctuation removal, stop-word removal, optional lemmatization  
- **Vectorization:** TF-IDF on unigrams & bigrams, filtering rare terms  
- **Labels:** Positive (≥4★) vs. Negative (≤2★) review buckets  
- **Inspection:** Compare distinctive TF-IDF terms across buckets  

### Findings
- **Positive reviews:** emphasize taste and hospitality  
  - *coffee, espresso, latte, delicious, friendly, staff, cozy, ambiance*  
  - TF-IDF weight in ≥4★ reviews ~0.025 vs. <0.005 in ≤2★  

- **Negative reviews:** dominated by operational friction  
  - *order, time, minutes, wait, line, drive-thru, wrong, cold*  
  - TF-IDF weight in ≤2★ reviews ~0.030 vs. <0.006 in ≥4★  

**Figure 3. Distinctive Terms by Rating Bucket**  
![NLP Terms](report/nlp_terms.png)

### Interpretation
- **High ratings** are earned through product quality and friendly staff.  
- **Low ratings** are driven by queue management, speed, and accuracy failures.  
- This confirms what SQL analysis suggested: **operations matter more than amenities.**

---

## Prototypes for Practical Metrics

- **Friction Index:** share of tokens linked to ops failures (order, wait, wrong, cold, refund, drive-thru).  
- **PAS (Price- & Attention-Adjusted Satisfaction):** deviation of actual stars from baseline predicted by review count + price band.  

These metrics could be tracked by location or over time to flag “hidden gems” or underperformers.

---

## Limitations & Extensions

- TF-IDF is bag-of-words: no context, sarcasm, or negation.  
- Ratings were bucketed (positive vs. negative), simplifying a continuum.  

**Future directions**
- Aspect-based sentiment (service vs. taste vs. ambiance).  
- Topic modeling (e.g. BERTopic) for richer themes.  
- Transformer sentiment (e.g. DistilBERT) for context/negation.  
- Queue-time features (bigram patterns like *long wait* or *wrong order*).  

---

## How to Reproduce

1. Install [PostgreSQL](https://www.postgresql.org/download/) locally.  
2. Clone this repo and install requirements:  
   ```bash
   pip install -r requirements.txt
3. Open the notebook in notebooks/, update DB password when prompted.
4. Run pipeline with included samples or download the full Yelp dataset.

---

## Repo Structure

yelp-nlp-sql-analysis/
├─ README.md
├─ requirements.txt
├─ notebooks/
│  ├─ analysis_yelp_clean.ipynb
│  └─ make_samples.ipynb
├─ data/
│  ├─ raw_data/
│  │   ├─ sample_business.csv
│  │   ├─ sample_review.csv
│  │   └─ (place Yelp JSONs here if using full dataset)
├─ report/
│  ├─ ratings_vs_reviews.png
│  ├─ amenities_vs_ratings.png
│  └─ nlp_terms.png

---

## Takeaway

Reputation in the Coffee & Tea sector is less about amenities or price bands, and more about operational execution:
- speed of service,
- accuracy of orders,
- and staff friendliness.
  
This blend of SQL analysis and NLP insights provides a roadmap for operators to monitor both structured data (ratings, counts) and unstructured text (reviews) in order to surface actionable signals.



